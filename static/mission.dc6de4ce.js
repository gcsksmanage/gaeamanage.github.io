import{d as D,r as w,e as k,K as L,o as T,c as F,j as l,i as a,b as C,t as z,u as o,h as j,k as p,D as q,E as V,L as I,M as P,s as G,q as S,x as W,y as B,z as X,A as J,_ as K,f as O,w as H,F as Q,l as Y,J as Z,m as ee,C as le,v as te}from"./entry.3e73d025.js";import{_ as oe}from"./client-only.61efab64.js";/* empty css                       */import{t as ae}from"./throttle.fca0157a.js";/* empty css                 *//* empty css                        *//* empty css                  *//* empty css                  *//* empty css                  */import{k as se,l as re,m as ne,n as ie}from"./adminManage.14b6e723.js";/* empty css                 *//* empty css                *//* empty css                     *//* empty css                   */import"./request.32f2fe59.js";const de={class:"text-[#ebebeb] text-[16px]"},ue={class:"w-full flex justify-end"},pe=D({__name:"Add",props:{dialogVisible:{type:Boolean,default:!1},item:{default:{}}},emits:["update:closeDialog","update:success"],setup(M,{emit:c}){const d=M,_=w(!1),e=k({id:null,code:"RETWEET_X",title:"",description:"",url:"",points:null,soul:null,order:1,mark:1,status:1,rewardType:1,rewardNum:1});L(()=>e.rewardType,s=>{s!==void 0&&(e.rewardNum=1)});const f=w(),g=k({title:[{required:!0,message:"请输入",trigger:"blur"}],description:[{required:!0,message:"请输入",trigger:"blur"}],url:[{required:!0,message:"请输入",trigger:"blur"}],rewardNum:[{required:!0,message:"请输入",trigger:"blur"}]}),b=s=>{s&&s.resetFields()},N=async s=>{s&&(_.value||await s.validate(async(t,m)=>{if(t)try{_.value=!0;const i={...e,id:d.item.id,points:e.rewardType===1?e.rewardNum:0,soul:e.rewardType===2?e.rewardNum:0};var r=null;i.id?(delete i.code,r=await se(i)):(delete i.id,r=await re(i)),r.code===200?(V.success({message:"创建成功",grouping:!0,type:"success"}),c("update:success"),y()):V.error({message:r.msg,grouping:!0,type:"error"})}catch{}finally{_.value=!1,b(s)}}))},y=()=>{c("update:closeDialog"),b(f.value)},U=async()=>{d.item.id?(e.id=d.item.id,e.title=d.item.title,e.description=d.item.description,e.url=d.item.url,e.order=d.item.order,e.mark=d.item.mark,e.status=d.item.status,e.rewardNum=d.item.points||d.item.soul):(e.id=null,e.code="RETWEET_X",e.title="",e.description="",e.url="",e.order=1,e.mark=1,e.status=1,e.rewardType=1,e.rewardNum=0)};return(s,t)=>{const m=I,r=P,i=G,v=S,x=W,E=B,$=X,u=J,R=oe;return T(),F("div",null,[l(R,null,{default:a(()=>[l(u,{draggable:"","model-value":s.$props.dialogVisible,style:{"background-color":"black",border:"1px  #ebebeb solid","border-radius":"10px","padding-bottom":"30px"},title:"",width:"550px",class:"px-10","align-center":"",onClose:y,onOpen:t[11]||(t[11]=A=>U())},{default:a(()=>{var A;return[C("p",de,z((A=o(e))!=null&&A.id?"编辑任务":"创建任务"),1),l($,{ref_key:"ruleFormRef",ref:f,class:"w-full p-5",inline:!0,"label-position":"right","label-width":"140px",model:o(e),rules:o(g)},{default:a(()=>{var h;return[(h=o(e))!=null&&h.id?q("",!0):(T(),j(i,{key:0,label:"选择类型:",prop:"code",class:"w-full"},{default:a(()=>[l(r,{modelValue:o(e).code,"onUpdate:modelValue":t[0]||(t[0]=n=>o(e).code=n)},{default:a(()=>[l(m,{label:"RETWEET_X"},{default:a(()=>[p("转推")]),_:1}),l(m,{label:"EVENT_PARTNER"},{default:a(()=>[p("合作")]),_:1})]),_:1},8,["modelValue"])]),_:1})),l(i,{label:"标题:",prop:"title",class:"w-full"},{default:a(()=>[l(v,{style:{width:"100%"},"controls-position":"right",modelValue:o(e).title,"onUpdate:modelValue":t[1]||(t[1]=n=>o(e).title=n),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1}),l(i,{label:"详情:",prop:"description",class:"w-full"},{default:a(()=>[l(v,{type:"textarea",style:{width:"100%"},"controls-position":"right",modelValue:o(e).description,"onUpdate:modelValue":t[2]||(t[2]=n=>o(e).description=n),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1}),l(i,{label:"任务链接:",prop:"url",class:"w-full"},{default:a(()=>[l(v,{style:{width:"100%"},"controls-position":"right",modelValue:o(e).url,"onUpdate:modelValue":t[3]||(t[3]=n=>o(e).url=n),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1}),l(i,{label:"排序:",prop:"order",class:"w-full"},{default:a(()=>[l(x,{style:{width:"100%"},min:1,max:1e3,"controls-position":"right",modelValue:o(e).order,"onUpdate:modelValue":t[4]||(t[4]=n=>o(e).order=n),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1}),l(i,{label:"奖励类型:",prop:"rewardType",class:"w-full"},{default:a(()=>[l(r,{modelValue:o(e).rewardType,"onUpdate:modelValue":t[5]||(t[5]=n=>o(e).rewardType=n)},{default:a(()=>[l(m,{label:1},{default:a(()=>[p("积分")]),_:1}),l(m,{label:2},{default:a(()=>[p("心灵点")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"数量:",prop:"rewardNum",class:"w-full"},{default:a(()=>[l(x,{style:{width:"100%"},min:1,max:o(e).rewardType===1?2e3:200,"controls-position":"right",modelValue:o(e).rewardNum,"onUpdate:modelValue":t[6]||(t[6]=n=>o(e).rewardNum=n),placeholder:"请输入",clearable:""},null,8,["max","modelValue"])]),_:1}),l(i,{label:"是否显示最新:",prop:"mark",class:"w-full"},{default:a(()=>[l(r,{modelValue:o(e).mark,"onUpdate:modelValue":t[7]||(t[7]=n=>o(e).mark=n)},{default:a(()=>[l(m,{label:1},{default:a(()=>[p("是")]),_:1}),l(m,{label:0},{default:a(()=>[p("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"是否删除:",prop:"status",class:"w-full"},{default:a(()=>[l(r,{modelValue:o(e).status,"onUpdate:modelValue":t[8]||(t[8]=n=>o(e).status=n)},{default:a(()=>[l(m,{label:0},{default:a(()=>[p("是")]),_:1}),l(m,{label:1},{default:a(()=>[p("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),C("div",ue,[l(E,{class:"w-[20%]",type:"info",onClick:t[9]||(t[9]=n=>y())},{default:a(()=>[p(" 取消 ")]),_:1}),l(E,{class:"w-[20%]",type:"success",loading:o(_),onClick:t[10]||(t[10]=n=>("throttle"in s?s.throttle:o(ae))(()=>{N(o(f))}))},{default:a(()=>[p(" 保存 ")]),_:1},8,["loading"])])]}),_:1},8,["model","rules"])]}),_:1},8,["model-value"])]),_:1})])}}});const me=K(pe,[["__scopeId","data-v-a7fd6bd0"]]),ce={class:"w-full h-[85vh] flex flex-col justify-between space-y-5 p-5"},fe={class:"flex items-center justify-end"},_e={class:"flex justify-end"},Me=D({__name:"mission",setup(M){const c=w(!1),d=w(!1),_=w(!1),e=w(),f=k({content:[]}),g=k({page:1,limit:20}),b=async()=>{try{d.value=!0;const s=await ne();d.value=!1,s.code===200?(f.content=s.data,f.totalElements=s.total):(f.content=[],f.totalElements=0,V({message:s.msg,grouping:!0,type:"error"}))}catch{d.value=!1}},N=s=>{g.page=s,b()},y=s=>{g.limit=s,b()},U=async()=>{try{_.value=!0;const s=await ie();_.value=!1,s.code===200?V({message:s.msg,grouping:!0,type:"success"}):V({message:s.msg,grouping:!0,type:"error"})}catch{}finally{_.value=!1}};return O(()=>{b()}),(s,t)=>{const m=B,r=Y,i=Z,v=ee,x=le,E=me,$=te;return T(),F("div",ce,[C("div",fe,[l(m,{class:"w-[100px]",type:"success",onClick:t[0]||(t[0]=u=>(c.value=!0,e.value={}))},{default:a(()=>[p(" 创建任务 ")]),_:1}),l(m,{class:"w-[100px]",type:"primary",onClick:t[1]||(t[1]=u=>U()),loading:o(_)},{default:a(()=>[p(" 发布任务 ")]),_:1},8,["loading"])]),H((T(),j(v,{ref:"multipleTableRef",class:"w-full flex-1",data:o(f).content,border:""},{default:a(()=>[l(r,{label:"标题",prop:"title",align:"center","show-overflow-tooltip":""}),l(r,{label:"详情",prop:"description",align:"center","show-overflow-tooltip":""}),l(r,{label:"任务链接",prop:"url",align:"center","show-overflow-tooltip":""}),l(r,{label:"编码",prop:"code",align:"center","show-overflow-tooltip":""}),l(r,{label:"奖励积分",prop:"points",align:"center"}),l(r,{label:"奖励心灵点",prop:"soul",align:"center"}),l(r,{label:"排序",prop:"order",align:"center"}),l(r,{label:"是否显示最新",prop:"mark",align:"center"},{default:a(u=>[p(z(u.row.mark?"是":"否"),1)]),_:1}),l(r,{label:"操作",align:"center"},{default:a(u=>[l(i,{type:"success",onClick:R=>(e.value=u.row,c.value=!0)},{default:a(()=>[p("编辑")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[$,o(d)]]),C("div",_e,[l(x,{"current-page":o(g).page,"onUpdate:currentPage":t[2]||(t[2]=u=>o(g).page=u),"page-size":o(g).limit,"onUpdate:pageSize":t[3]||(t[3]=u=>o(g).limit=u),"page-sizes":[20,50,100,500,1e3],layout:"total, sizes, prev, pager, next, jumper",total:o(f).totalElements,onCurrentChange:N,onSizeChange:y},null,8,["current-page","page-size","total"])]),l(E,{modelValue:o(c),"onUpdate:modelValue":t[4]||(t[4]=u=>Q(c)?c.value=u:null),"dialog-visible":o(c),"onUpdate:closeDialog":t[5]||(t[5]=u=>c.value=!1),item:o(e),"onUpdate:success":t[6]||(t[6]=u=>b())},null,8,["modelValue","dialog-visible","item"])])}}});export{Me as default};
